{{> clinician_sidebar}}

<div class="panel-content">
    <div class="wt-grid-container">

        {{!-- Heading and Subheading --}}
        <div class="wt-grid-item size-9@t">
            <h1>Dashboard</h1>
            <p style="display: inline;">Today :
            <p id="date" style="display: inline;"></p>
            </p>
        </div>

        {{!-- Add Patient Button --}}
        <div class="wt-grid-item size-3@t">
            <div class="wt-text-align-right">
                <button class="wt-btn wt-btn-secondary wt-btn-with-icon" onclick="openModal('addPatientModal')">
                    <i class="material-icons">add</i> ADD PATIENT</button>
            </div>
        </div>

        {{!-- Instructions --}}

        <div class="wt-grid-item size-12@p size-12@t">
            <p>Here you can find the today's health data of your patients</p>
            <br />
            <p><span class="wt-color-red" style="color: red;">RED</span> means out of Threshold</p>
            <p><span class="wt-color-amber" style="color: rgb(165, 165, 58);">AMBER</span> means this value was not
                registed yet</p>
            <br />
            <p>HOVER the value to see the lower and upper Thresholds</p>
        </div>




        {{!-- Patient Data Card Rows --}}
        <div class="wt-grid-item size-12@t">
            <div class="wt-card-content">
                <div class="wt-grid-container">
                    <div class="wt-grid-item size-1@t">
                    </div>
                    <div class="wt-grid-item size-2@t">
                        <strong>Full Name</strong>
                    </div>
                    <div class="wt-grid-item size-2@t">
                        <strong>Blood Glucose Level</strong>
                    </div>
                    <div class="wt-grid-item size-2@t">
                        <strong>Weight</strong>
                    </div>
                    <div class="wt-grid-item size-2@t">
                        <strong>Insulin Doses</strong>
                    </div>
                    <div class="wt-grid-item size-2@t">
                        <strong>Exercise</strong>
                    </div>
                    <div class="wt-grid-item size-1@t">
                    </div>
                </div>
            </div>

            {{!-- Fetch database data --}}
            {{#each patients}}
            <div class="wt-card">
                <div class="wt-card-content">
                    <div class="wt-grid-container">
                        <div class="wt-grid-item size-1@t">
                            <img class="wt-border-rounded" src="{{patientData.urlImage}}" width="40px">

                        </div>
                        <div class="wt-grid-item size-2@t">

                            <a href="./clinician_dashboard/{{_id}}/clinician_patient_data">
                                {{givenName}} {{familyName}}
                            </a>
                        </div>


                        <div class="wt-grid-item size-2@t"
                            id="{{#checkOutOfThreshold record_patient.0.glucoseLevel.outOfTheThreshold}} {{/checkOutOfThreshold}}">
                            {{#if record_patient.0.glucoseLevel.value}}
                            {{{record_patient.0.glucoseLevel.value}}}
                            {{!-- {{record_patient.0.glucoseLevel.mandatory}} --}}
                            {{else}}

                            {{#if (isfill record_patient.0.glucoseLevel.mandatory)}}
                            {{!-- <div>Hii</div> --}}
                            <span style="color: rgb(165, 165, 58);">
                                Not available
                            </span>
                            {{else}}
                            ---
                            {{/if}}

                            {{!-- {{/else}} --}}
                            {{/if}}
                            {{#if (checkLength record_patient.0.glucoseLevel.comment)}}
                            <i class="material-icons" style="font-size: smaller; cursor: pointer;"
                                onclick="openModal('patientCommentModal1')">message</i>
                            {{/if }}
                        </div>


                        <div class="wt-grid-item size-2@t"
                            id="{{#checkOutOfThreshold record_patient.0.weight.outOfTheThreshold}} {{/checkOutOfThreshold}}">

                            {{#if record_patient.0.weight.value}}
                            {{{record_patient.0.weight.value}}}
                            {{else}}

                            {{#if (isfill record_patient.0.weight.mandatory)}}
                            {{!-- <div>Hii</div> --}}
                            <span style="color: rgb(165, 165, 58);">
                                Not available
                            </span>
                            {{else}}
                            ---
                            {{/if}}

                            {{!-- {{/else}} --}}
                            {{/if}}
                            {{#if (checkLength record_patient.0.weight.comment 0) }}
                            <i class="material-icons" style="font-size: smaller; cursor: pointer;"
                                onclick="openModal('patientCommentModal2')">message</i>
                            {{/if}}

                        </div>


                        <div class="wt-grid-item size-2@t"
                            id="{{#checkOutOfThreshold record_patient.0.insulinDoses.outOfTheThreshold}} {{/checkOutOfThreshold}} ">
                            {{#if record_patient.0.insulinDoses.value}}
                            {{record_patient.0.insulinDoses.value}}

                            {{else}}

                            {{#if (isfill record_patient.0.insulinDoses.mandatory)}}
                            {{!-- <div>Hii</div> --}}
                            <span style="color: rgb(165, 165, 58);">
                                Not available
                            </span>
                            {{else}}
                            ---
                            {{/if}}

                            {{/if}}

                            {{#if (checkLength record_patient.0.insulinDoses.comment 0) }}
                            <i class="material-icons" style="font-size: smaller; cursor: pointer;"
                                onclick="openModal('patientCommentModal3')">message</i>
                            {{/if}}
                        </div>


                        <div class="wt-grid-item size-2@t"
                            id="{{#checkOutOfThreshold record_patient.0.exercise.outOfTheThreshold}} {{/checkOutOfThreshold}} {{#checkMandatoryAndNull exercise.mandatory exercise.value }} {{/checkMandatoryAndNull}}">
                            {{#if record_patient.0.exercise.value}}
                            {{record_patient.0.exercise.value}}

                            {{else}}

                            {{#if (isfill record_patient.0.exercise.mandatory)}}
                            {{!-- <div>Hii</div> --}}
                            <span style="color: rgb(165, 165, 58);">
                                Not available
                            </span>
                            {{else}}
                            ---
                            {{/if}}

                            {{/if}}


                            {{#if (checkLength record_patient.0.exercise.comment 0) }}
                            <i class="material-icons" style="font-size: smaller; cursor: pointer;"
                                onclick="openModal('patientCommentModal4')">message</i>
                            {{/if}}
                        </div>
                        {{!-- <div class="wt-grid-item size-1@t">
                            <i class="material-icons" style="cursor: pointer;"
                                onclick="openModal('patientCommentModal')">message</i>
                        </div> --}}
                    </div>
                </div>
            </div>
            <br />
            {{/each}}
        </div>
    </div>

    {{!-- Add Patient Modal --}}
    <div id="addPatientModal" class="wt-modal">
        <div class="wt-modal-content">
            <span class="wt-modal-close">&times;</span>
            <form action="/clinician_dashboard/insertPatient" method="POST">
                <div class="wt-grid-container">
                    <div class="wt-grid-item size-12@t">
                        <h2>Add Patient</h2>
                        <p>Please enter the following details</p>
                    </div>
                    <div class="wt-grid-item size-6@t">
                        <label>Given Name</label>
                        <input name="givenName" type="text" />
                    </div>
                    <div class="wt-grid-item size-6@t">
                        <label>Family Name</label>
                        <input name="familyName" type="text" />
                    </div>
                    <div class="wt-grid-item size-6@t">
                        <label>Email</label>
                        <input name="email" type="email" />
                    </div>
                    <div class="wt-grid-item size-6@t">
                        <label>Year of Birth</label>
                        <input name="yearOfBirth" type="text" pattern="\d*" placeholder="YYYY" maxlength="4" />
                    </div>
                    <div class="wt-grid-item size-6@t">
                        <label>Screen Name</label>
                        <input name="screenName" type="text" />
                    </div>
                    <div class="wt-grid-item size-12@t">
                        <label>Bio</label>
                        <textarea rows="5" name="bio"></textarea>
                    </div>
                    <div class="wt-grid-item size-12@t">
                        <div class="wt-text-align-right">
                            <button type="submit" class="wt-btn wt-btn-secondary">ADD PATIENT</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>




    {{!-- Patient Comment Modal --}}
    <div id="patientCommentModal1" class="wt-modal">
        <div class="wt-modal-content">
            <span class="wt-modal-close">&times;</span>
            <form action="/clinician_dashboard/PatientComment" method="POST">
                <div class="wt-grid-container">
                    <div class="wt-grid-item size-12@t">
                        <h2>Patient Comment</h2>
                    </div>
                    <div class="wt-grid-item size-12@t">
                        <textarea readonly rows="5" style="color: black;">
                            {{!-- Not printing these ! --}}
                            {{!-- {{ record_patient.0.glucoseLevel.comment}}  --}}
                            {{!-- {{{record_patient.0.glucoseLevel.value}}} --}}
                            {{!-- Hi --}}
                        </textarea>
                    </div>
                </div>
                <div class="wt-grid-item size-12@t">
                    <div class="wt-text-align-right">
                        <button type="submit" class="wt-btn wt-btn-secondary">SAVE</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div id="patientCommentModal2" class="wt-modal">
        <div class="wt-modal-content">
            <span class="wt-modal-close">&times;</span>
            <form action="/clinician_dashboard/PatientComment" method="POST">
                <div class="wt-grid-container">
                    <div class="wt-grid-item size-12@t">
                        <h2>Patient Comment</h2>
                    </div>
                    <div class="wt-grid-item size-12@t">
                        <textarea readonly rows="5">
                             {{record_patient.0.weight.comment}}
                        </textarea>
                    </div>
                </div>
                <div class="wt-grid-item size-12@t">
                    <div class="wt-text-align-right">
                        <button type="submit" class="wt-btn wt-btn-secondary">SAVE</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div id="patientCommentModal3" class="wt-modal">
        <div class="wt-modal-content">
            <span class="wt-modal-close">&times;</span>
            <form action="/clinician_dashboard/PatientComment" method="POST">
                <div class="wt-grid-container">
                    <div class="wt-grid-item size-12@t">
                        <h2>Patient Comment</h2>
                    </div>
                    <div class="wt-grid-item size-12@t">
                        <textarea readonly rows="5">
                             {{record_patient.0.insulineDoses.comment}}

                        </textarea>
                    </div>
                </div>
                <div class="wt-grid-item size-12@t">
                    <div class="wt-text-align-right">
                        <button type="submit" class="wt-btn wt-btn-secondary">SAVE</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div id="patientCommentModal4" class="wt-modal">
        <div class="wt-modal-content">
            <span class="wt-modal-close">&times;</span>
            <form action="/clinician_dashboard/PatientComment" method="POST">
                <div class="wt-grid-container">
                    <div class="wt-grid-item size-12@t">
                        <h2>Patient Comment</h2>
                    </div>
                    <div class="wt-grid-item size-12@t">
                        <textarea readonly rows="5">
                             {{record_patient.0.exercise.comment}}

                        </textarea>
                    </div>
                </div>
                <div class="wt-grid-item size-12@t">
                    <div class="wt-text-align-right">
                        <button type="submit" class="wt-btn wt-btn-secondary">SAVE</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script>n = new Date();
    y = n.getFullYear();
    m = n.getMonth() + 1;
    d = n.getDate();
    document.getElementById("date").innerHTML = m + "/" + d + "/" + y;</script>